Ghost Inspector Test Generator - Example Run
==============================================

This example demonstrates a complete run of the script with various scenarios:
- Valid URLs (mixed domains)
- Invalid URLs (skipped with warning)
- Duplicate URLs (skipped with warning)
- Existing files (overwrite warning)
- Final output with _notes.txt generation

$ ./generate-tests.sh

Ghost Inspector Test Generator
===============================

Template options:

  1) Use templates/template.json (default)
     Recommended for most tests
     - Visual regression testing (10% threshold)
     - Screenshot comparison enabled
     - Manual test execution
     - Scrolls page 50px to trigger lazy-loaded content
     See: templates/template.md for detailed settings

  2) Paste custom template
     Provide your own JSON configuration
     Must contain TEST_NAME and START_URL placeholders

Select option [1]: 1

Using templates/template.json

Paste your URLs (one per line).
Press Enter on an empty line when done:

https://example.com/
https://example.com/
https://not-a-url
  https://example.com/about/
https://example.com/products/
https://example.com/products/
https://other-site.com/
https://other-site.com/contact/

Warning: Skipped 1 invalid URL(s):
  Line 3: https://not-a-url

Warning: Skipped 2 duplicate URL(s):
  https://example.com/
  https://example.com/products/

The following test files will be created:
-----------------------------------------
  build/example.com/Home.json  <--  https://example.com/  [OVERWRITE]
  build/example.com/About.json  <--  https://example.com/about/
  build/example.com/Products.json  <--  https://example.com/products/
  build/other-site.com/Home.json  <--  https://other-site.com/
  build/other-site.com/Contact.json  <--  https://other-site.com/contact/

Warning: 1 file(s) will be overwritten.

Total: 5 test(s)

Proceed with file creation? (y/n): y

Creating test files...
  Created: build/example.com/Home.json
  Created: build/example.com/About.json
  Created: build/example.com/Products.json
  Created: build/other-site.com/Home.json
  Created: build/other-site.com/Contact.json

Done! Created 5 test file(s).

Generating notes...
  Created: build/example.com/_notes.txt
  Created: build/other-site.com/_notes.txt

Import tests to Ghost Inspector suite? (y/n): y

Enter API Key:
(input is hidden - type your API key and press Enter - characters will not appear on screen)

Fetching suites from Ghost Inspector...

Available suites:
-----------------
  1) Production Tests (suite_abc123)
  2) Staging Tests (suite_def456)
  3) Development (suite_ghi789)

Select suite [1-3]: 1

Selected: Production Tests (suite_abc123)

Import 5 test(s) to this suite? (y/n): y

Importing tests to Ghost Inspector...

  Importing example.com/Home.json... OK
  Importing example.com/About.json... OK
  Importing example.com/Products.json... OK
  Importing other-site.com/Home.json... OK
  Importing other-site.com/Contact.json... OK

Import complete!
  Success: 5
  Failed:  0


Generated Output Structure
==========================

build/
├── example.com/
│   ├── _notes.txt
│   ├── Home.json
│   ├── About.json
│   └── Products.json
└── other-site.com/
    ├── _notes.txt
    ├── Home.json
    └── Contact.json


Example _notes.txt (build/example.com/_notes.txt)
===================================================

# example.com

**Last Run:** 2026-01-15 14:32:05
**Template:** template.json

---

## Tests

| File | Test Name | URL |
|------|-----------|-----|
| Home.json | Home | https://example.com/ |
| About.json | About | https://example.com/about/ |
| Products.json | Products | https://example.com/products/ |

---

## Settings

| Setting | Value |
|---------|-------|
| Screenshot Compare | enabled |
| Screenshot Threshold | 0.1 |
| Fail on JS Error | default |
| Auto Retry | default |
| Browser | default |
| Viewport | default |
| Region | default |
| Test Frequency | manual |
| Disallow Insecure Certs | default |
| Max Ajax Delay | default |
| Max Wait Delay | default |
| Final Delay | default |
| Global Step Delay | default |

---

## HTTP Headers

None

---

## Steps (1)

1. **eval** - `document.addEventListener('DOMContentLoaded', function() {window.scrollBy({top: 50});});`


Key Points from This Example
=============================

1. VALIDATION
   - Invalid URL format rejected: "https://not-a-url"
   - Exact duplicates skipped: 2 occurrences of https://example.com/
   - Whitespace automatically trimmed: "  https://example.com/about/  "

2. DOMAIN ORGANIZATION
   - Files grouped by domain: example.com/ and other-site.com/
   - Each domain gets its own _notes.txt
   - Easy to manage multiple domains in one run

3. OVERWRITE WARNING
   - Shows [OVERWRITE] indicator for existing files
   - Warning displayed before confirmation
   - Single confirmation required (not per-file)

4. NOTES GENERATION
   - Automatic markdown file per domain
   - Contains run timestamp and template used
   - Documents all test files and settings
   - Useful for tracking when tests were created

5. API IMPORT
   - Dynamic suite fetching (not manual entry)
   - Shows available suites
   - Allows suite selection from list
   - Success/failure reported per import

6. ERROR HANDLING
   - Script continues despite warnings
   - Reports invalid/duplicate URLs
   - Proceeds with valid URLs
   - No silent failures

7. API KEY SECURITY
   - API key input is hidden (silent mode)
   - Characters do not appear on screen while typing
   - Key never stored in script, config files, or history
   - Only transmitted securely to Ghost Inspector API
   - Safely discarded after API session


Security Practices for API Keys
================================

SECURE APPROACH (What This Script Does)
========================================

✓ Interactive Prompt - User pastes API key when needed
✓ Hidden Input - Key typed with `-s` flag (no echo to terminal)
✓ No Storage - Key exists only in memory during session
✓ No History - Key not saved to shell history
✓ No Logs - Key never written to log files
✓ Session-Only - Key discarded after API import completes

Benefits:
- Prevents accidental key exposure
- Key not stored on disk
- No lingering key in shell history
- Easy to revoke key if compromised
- No configuration file vulnerabilities


INSECURE APPROACH (DON'T DO THIS)
==================================

✗ Hardcoding - Never put API key directly in script:
   api_key="your-secret-key-here"  # BAD!

✗ Config Files - Never store in plaintext config:
   API_KEY=sk_live_abc123  # BAD!

✗ Environment Variables - Global env vars can be accessed:
   export GHOST_INSPECTOR_API_KEY="..."  # RISKY

✗ Command Arguments - Never pass as CLI argument:
   ./script.sh --api-key=secret123  # BAD!

Risks:
- Key visible in version control (GitHub, Git history)
- Key visible in shell history (history command)
- Key readable by other users if shared script
- Key exposed in process listing (ps aux)
- Key leaked if system compromised
- Key visible in logs/backups
- Difficult to rotate key securely


Best Practices
==============

1. Use Interactive Input
   - Let script prompt for sensitive data
   - User controls when key is entered
   - Key never persists on disk

2. When Sharing Scripts
   - Never include API keys in scripts
   - Document that script will prompt for key
   - Provide example without credentials

3. For CI/CD Pipelines
   - Use CI/CD secret management (GitHub Secrets, GitLab CI/CD Variables)
   - CI/CD platform handles secure storage and injection
   - Never commit secrets to repository

4. Key Rotation
   - Periodically regenerate API keys
   - Immediately revoke compromised keys
   - Easy to revoke with interactive-only approach

5. Terminal Safety
   - Clear terminal after script runs
   - Don't share terminal screenshots with keys visible
   - Use `clear` or `reset` command to wipe screen
